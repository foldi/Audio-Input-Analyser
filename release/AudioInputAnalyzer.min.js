/*! AudioInputAnalyzer v1.0.0 - 2013-09-02 03:09:31 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){function c(){this.context=null,this.analyser=null,this.freqDomain=null,this.timeDomain=null}b.AudioInputAnalyzer=a,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.AudioContextClass=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var d=[31,63,125,250,500,1e3,2e3,4e3,8e3,16e3],e=[20,25,31,40,50,63,80,100,126,160,201,253,320,403,507,640,806,1e3,1300,1600,2e3,2500,3200,4e3,5100,6400,8100,1e4,13e3,16e3,2e4];c.prototype.map=function(a,b,c,d,e){var f=(a-b)/(c-b);return f*(e-d)+d},c.prototype.init=function(){if(!this.hasWebAudio())throw new Error("Web Audio API is not supported in your browser.");if(this.context=new window.AudioContextClass,!this.hasGetUserMedia())throw new Error("getUserMedia() is not supported in your browser.");navigator.getMedia({audio:!0},this.handleUserMedia.bind(this),this.failUserMedia)},c.prototype.handleUserMedia=function(a){this.microphone=this.context.createMediaStreamSource(a),this.meter=this.context.createJavaScriptNode(2048,1,1),this.meter.onaudioprocess=this.processAudio.bind(this),this.meter.connect(this.context.destination),this.analyser1=this.context.createAnalyser(),this.analyser1.smoothingTimeConstant=.3,this.analyser1.fftSize=512,this.analyser2=this.context.createAnalyser(),this.analyser2.smoothingTimeConstant=0,this.analyser2.fftSize=512,this.splitter=this.context.createChannelSplitter(),this.microphone.connect(this.splitter),this.splitter.connect(this.analyser1,0,0),this.splitter.connect(this.analyser2,1,0),this.analyser1.connect(this.meter)};var f=0,g=50;c.prototype.processAudio=function(b){var c,d,e,f=b.inputBuffer.getChannelData(0),g=new Uint8Array(this.analyser1.frequencyBinCount),h=new Uint8Array(this.analyser2.frequencyBinCount),i=new Uint8Array(this.analyser1.frequencyBinCount),j=new Uint8Array(this.analyser2.frequencyBinCount);c=this.getArrayAbsoluteAverage(f),this.analyser1.getByteFrequencyData(g),d=this.getArrayAverage(g),this.analyser2.getByteFrequencyData(h),e=this.getArrayAverage(h),this.analyser1.getByteFrequencyData(g),this.analyser2.getByteFrequencyData(h),this.analyser1.getByteTimeDomainData(i),this.analyser2.getByteTimeDomainData(j),a.PubSub.publish("meter",{channelLevel:c,averageVol1:d,averageVol2:e,freqDomain1:g,freqDomain2:h,timeDomain1:i,timeDomain2:j})},c.prototype.getArrayAverage=function(a){var b,c,d=0;for(b=0,c=a.length;c>b;b++)d+=a[b];return d/c},c.prototype.getArrayAbsoluteAverage=function(a){var b,c,d=0;for(b=0,c=a.length;c>b;b++)d+=Math.abs(a[b]);return d/c},c.prototype.failUserMedia=function(a){document.body.textContent="Failed to get user media. "+a.name},c.prototype.getFrequencyValue=function(a){var b=this.context.sampleRate/2,c=Math.round(a/b*this.freqDomainFloat.length);return this.freqDomainFloat[c]},c.prototype.hasWebAudio=function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)},c.prototype.hasGetUserMedia=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},c.prototype.getViewportSize=function(){var a={width:void 0,height:void 0};return"undefined"!=typeof window.innerWidth?(a.width=window.innerWidth,a.height=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth?(a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight):"undefined"!=typeof document.body&&(a.width=document.body.clientWidth,a.height=document.body.clientHeight),a};var h={};h.subscribe=function(a,b){return this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(b),this},h.publish=function(){var a,b,c,d,e=Array.prototype.slice.call(arguments,0),f=e.shift();if(!(b=this._callbacks))return this;if(!(a=this._callbacks[f]))return this;for(c=0,d=a.length;d>c;c+=1)a[c].apply(this,e);return this},a.BAND10=d,a.BAND31=e,a.AudioController=c,a.i=f,a.limit=g,a.PubSub=h}({},function(){return this}());
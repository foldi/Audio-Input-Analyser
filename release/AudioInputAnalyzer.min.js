/*! AudioInputAnalyzer v1.0.0 - 2013-08-31 06:08:07 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){function c(){this.context=null,this.analyser=null,this.freqDomain=null,this.timeDomain=null}b.AudioInputAnalyzer=a,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),c.prototype.init=function(){if("undefined"!=typeof AudioContext)this.context=new AudioContext;else{if("undefined"==typeof webkitAudioContext)throw new Error("AudioContext not supported. :(");this.context=new webkitAudioContext}this.hasGetUserMedia()?navigator.getMedia({audio:!0},this.handleUserMedia.bind(this),this.failUserMedia):document.body.textContent="getUserMedia() is not supported in your browser"},c.prototype.handleUserMedia=function(a){var b=this.context.createMediaStreamSource(a);this.analyser=this.context.createAnalyser(),b.connect(this.analyser),this.analyser.connect(this.context.destination),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.loop()},c.prototype.loop=function(){this.analyser.getByteFrequencyData(this.freqDomain),this.analyser.getByteTimeDomainData(this.timeDomain),a.PubSub.publish("analyse",{frequencyBinCount:this.analyser.frequencyBinCount,freqDomain:this.freqDomain,timeDomain:this.timeDomain}),requestAnimFrame(this.loop.bind(this))},c.prototype.failUserMedia=function(a){document.body.textContent="Failed to get user media. "+a.name},c.prototype.getFrequencyValue=function(a){var b=context.sampleRate/2,c=Math.round(a/b*freqDomain.length);return freqDomain[c]},c.prototype.hasGetUserMedia=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)};var d={};d.subscribe=function(a,b){return this._callbacks||(this._callbacks={}),(this._callbacks[a]||(this._callbacks[a]=[])).push(b),this},d.publish=function(){var a,b,c,d,e=Array.prototype.slice.call(arguments,0),f=e.shift();if(!(b=this._callbacks))return this;if(!(a=this._callbacks[f]))return this;for(c=0,d=a.length;d>c;c+=1)a[c].apply(this,e);return this},a.AudioController=c,a.PubSub=d}({},function(){return this}());
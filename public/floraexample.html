<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' content='text/html; charset=UTF-8' />
  <meta name='viewport' content='user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0' />
  <meta name='apple-mobile-web-app-capable' content='yes' />
  <title>Audio Input Analyser</title>
  <link href='css/burner.min.css' rel='stylesheet' type='text/css' charset='utf-8' />
  <link href='css/flora.min.css' rel='stylesheet' type='text/css' charset='utf-8' />
  <link href='css/AudioInputAnalyzer.min.css' rel='stylesheet' type='text/css' charset='utf-8' />
  <script src='scripts/burner.min.js' type='text/javascript' charset='utf-8'></script>
  <script src='scripts/flora.min.js' type='text/javascript' charset='utf-8'></script>
  <script src='scripts/AudioInputAnalyzer.min.js' type='text/javascript' charset='utf-8'></script>
  </head>
  <body>
    <script type='text/javascript' charset='utf-8'>

      var world = new Burner.World(document.body, {
        gravity: new Burner.Vector(),
        c: 0
      });

      Burner.System.init(function() {
        this.add('Agent');
      }, world);

      //

      var audioController = new AudioInputAnalyzer.AudioController();
      audioController.init();

      var i, max, channel, viewportSize = audioController.getViewportSize();

      for (i = 0; i < 2; i++) {
        channel = document.createElement('div');
        channel.className = 'channel ' + (!i ? 'left' : 'right');
        channel.id = 'channel' + (i + 1);
        document.body.appendChild(channel);
      }

      var channelLeft = document.getElementById('channel1'),
          channelRight = document.getElementById('channel2');

      AudioInputAnalyzer.PubSub.subscribe('meter', function(data) {
        channelLeft.style.height = audioController.map(data.averageVol1, 0, 130, 0, viewportSize.height / 2) + 'px';
        channelRight.style.height = audioController.map(data.averageVol2, 0, 130, 0, viewportSize.height / 2) + 'px';

        var agent = Burner.System.getAllItemsByName('Agent')[0];
        agent.applyForce(new Burner.Vector(0, -data.channelLevel * 10));
      });

    </script>
  </body>
</html>
